parameters:
- name: NpmTag
  type: string
  default: 'dev'

jobs:
- job: publish_onnxruntime_web
  continueOnError: true
  pool: 'Win-CPU-2019'

  timeoutInMinutes: 30
  workspace:
    clean: all
  steps:
  - checkout: none
    submodules: false
  - task: DownloadPipelineArtifact@2
    inputs:
      artifact: 'NPM_packages'
      path: $(Pipeline.Workspace)\NPM_packages
    displayName: 'Get packed artifacts'
  - task: NodeTool@0
    inputs:
      versionSpec: '14.x'
  - script: |
     dir /b onnxruntime-common* > ort-common_filename.txt
     set /p __ort_common_pkg_filename__=<ort-common_filename.txt
     echo.Publishing package %__ort_common_pkg_filename__% ...
     npm publish %__ort_common_pkg_filename__% --tag ${{ parameters.NpmTag }} --dry-run
    workingDirectory: '$(Pipeline.Workspace)\NPM_packages'
    displayName: 'publish onnxruntime-common ...'
  - script: |
     dir /b onnxruntime-web* > ort-web_filename.txt
     set /p __ort_web_pkg_filename__=<ort-web_filename.txt
     echo.Publishing package %__ort_web_pkg_filename__% ...
     npm publish %__ort_web_pkg_filename__% --tag ${{ parameters.NpmTag }} --dry-run
    workingDirectory: '$(Pipeline.Workspace)\NPM_packages'
    displayName: 'publish onnxruntime-web ...'
  - template: component-governance-component-detection-steps.yml
    parameters :
      condition : 'succeeded'
  - task: mspremier.PostBuildCleanup.PostBuildCleanup-task.PostBuildCleanup@3
    displayName: 'Clean Agent Directories'
    condition: always()
