# Setup python/nodejs/cmake/vcpkg tools. Also, setup telemetry header file if the current OS is Windows.

parameters:
- name: build_arch
  type: string
  default: 'x64'

- name: python_version
  type: string
  default: '3.12'
  
- name: action_version
  type: string
  default: 'v0.0.8'

steps:
- template: telemetry-steps.yml
  
- task: UsePythonVersion@0
  displayName: Use Python 3.12
  inputs:
    versionSpec: ${{ parameters.python_version }}
    ${{ if eq(parameters.build_arch, 'x86') }}:
      architecture: 'x86'

- task: PipAuthenticate@1
  displayName: 'Pip Authenticate'
  inputs:
    artifactFeeds: 'Lotus'

- task: NodeTool@0
  inputs:
    versionSpec: '22.x'

- script: python3 -m pip install requests

- task: PythonScript@0
  displayName: 'Run GitHub Action via Python Wrapper'
  inputs:
    scriptPath: 'tools/ci_build/run_gh_action.py'
    arguments: '${{ parameters.action_version }}'

- pwsh: |
    $ErrorActionPreference = 'Stop'

    Write-Host "Verifying CMake installation..."
    cmake --version

    Write-Host "Verifying vcpkg installation..."
    & "$env:VCPKG_INSTALLATION_ROOT/vcpkg" version
    
    Write-Host "Tool verification successful."
  displayName: 'Verify Tools'