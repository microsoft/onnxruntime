# sets up common build tools for the windows build machines before build

parameters:
- name: arch
  type: string
  default: 'linux-x64'
- name: buildConfig
  type: string
  default: 'RelWithDebInfo'
- name: artifactName
  type: string
  default: 'onnxruntime-java-linux-x64'
- name: libraryName
  type: string
  default: 'libonnxruntime.so'
- name: nativeLibraryName
  type: string
  default: 'libonnxruntime4j_jni.so'
- name: version
  type: string
  default: ''
- name: is1ES
  type: boolean
  default: false
steps:
- task: ShellScript@2
  displayName: 'Copy build artifacts for zipping'
  inputs:
    scriptPath: 'tools/ci_build/github/linux/java_copy_strip_binary.sh'
    args: '-r $(Build.BinariesDirectory) -c ${{parameters.buildConfig}} -a ${{parameters.artifactName}} -l ${{parameters.libraryName}} -n ${{parameters.nativeLibraryName}} -v ${{parameters.version}} -h ${{parameters.arch}}'
    workingDirectory: '$(Build.BinariesDirectory)/${{parameters.buildConfig}}'

- ${{ if eq(parameters.is1ES, true) }}:
  - task: 1ES.PublishPipelineArtifact@1
    inputs:
      targetPath: '$(Build.BinariesDirectory)/${{parameters.artifactName}}'
      artifactName: 'drop-${{parameters.artifactName}}'
- ${{ if eq(parameters.is1ES, false) }}:
  - task: PublishBuildArtifacts@1
    inputs:
      pathtoPublish: '$(Build.BinariesDirectory)/${{parameters.artifactName}}'
      artifactName: 'drop-${{parameters.artifactName}}'
