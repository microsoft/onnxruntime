name: Qualcomm_Internal_Windows_CI
on:
  push:
    branches:
      - main
      - rel-*
  pull_request:
    branches:
      - main

jobs:
  Windows-Build-Test-All:
    runs-on: ["self-hosted", "Windows", "X64"]
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: false

      - name: Windows aarch64 Build
        shell: cmd
        run: |
          ${{ vars.VCVARSALL }} amd64 && ^
          .\build.bat --config RelWithDebInfo --build_shared_lib --parallel ^
          --cmake_generator "Visual Studio 17 2022" ^
          --use_qnn --qnn_home ${{ vars.QNN_SDK_ROOT }} --arm64 ^
          --build_dir build_arm64 --path_to_protoc_exe ${{ vars.PROTOC_PATH }}

      - name: Windows X86_64 Build
        shell: cmd
        run: |
          ${{ vars.VCVARSALL }} amd64 && ^
          .\build.bat --config RelWithDebInfo --build_shared_lib --parallel ^
          --compile_no_warning_as_error --cmake_generator "Visual Studio 17 2022" ^
          --use_qnn --qnn_home ${{ vars.QNN_SDK_ROOT }} ^
          --build_dir build_x86
