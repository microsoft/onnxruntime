#
# SPDX-FileCopyrightText: Copyright 2025 Arm Limited and/or its affiliates <open-source-office@arm.com>
#
# SPDX-License-Identifier: MIT
#

test_release_ubuntu_mlas:
  extends:
    - .default_settings
    - .default_settings_test
  stage: test
  image: mleng--registry.eu-west-1.artifactory.aws.arm.com/kleidi-integrations/onnxrt-builder:0.0.2
  needs:
    - job: build_release_ubuntu
      artifacts: true
  script:
    - cd build/Linux/Release && ./onnxruntime_mlas_test --gtest_output=xml:report.xml
  artifacts:
    paths:
      - build/Linux/Release/report.xml
    expire_in: 1h

test_release_ubuntu_ort_testall:
  extends:
    - .default_settings
    - .default_settings_test
  stage: test
  image: mleng--registry.eu-west-1.artifactory.aws.arm.com/kleidi-integrations/onnxrt-builder:0.0.2
  needs:
    - job: build_release_ubuntu
      artifacts: true
  script:
    - cd build/Linux/Release && ./onnxruntime_test_all --gtest_output=xml:report_all.xml
  allow_failure: true
  artifacts:
    paths:
      - build/Linux/Release/report_all.xml
    expire_in: 1h

# test_debug_ubuntu:
#   extends:
#     - .default_settings
#     - .default_settings_test
#   stage: test
#   image: mleng--registry.eu-west-1.artifactory.aws.arm.com/kleidi-integrations/onnxrt-builder:0.0.2
#   needs:
#     - job: build_debug_ubuntu
#       artifacts: true
#   script:
#     - cd build/Linux/Debug && ./onnxruntime_mlas_test --gtest_output=xml:report.xml
#   artifacts:
#     paths:
#       - build/Linux/Debug/report.xml
#     expire_in: 1h


test_release_mac_mlas:
  extends:
    - .mac_common
  stage: test
  tags:
    - mac-mini
  needs:
    - job: mac_release_build
      artifacts: true
  script:
    - cd build/MacOS/Release/Release && ./onnxruntime_mlas_test --gtest_output=xml:report.xml
  artifacts:
    paths:
      - build/MacOS/Release/Release/report.xml
    expire_in: 1h

test_release_mac_ort_testall:
  extends:
    - .mac_common
  stage: test
  tags:
    - mac-mini
  needs:
    - job: mac_release_build
      artifacts: true
  script:
    - cd build/MacOS/Release/Release && ./onnxruntime_test_all --gtest_output=xml:report_all.xml
  allow_failure: true
  artifacts:
    paths:
      - build/MacOS/Release/Release/report_all.xml
    expire_in: 1h

# test_debug_mac:
#   extends:
#     - .mac_common
#   stage: test
#   tags:
#     - mac-mini
#   needs:
#     - job: mac_debug_build
#       artifacts: true
#   script:
#     - cd build/MacOS/Debug/Debug && ./onnxruntime_mlas_test --gtest_output=xml:report.xml
#   allow_failure: true
#   artifacts:
#     paths:
#       - build/MacOS/Debug/Debug/report.xml
#     expire_in: 1h
